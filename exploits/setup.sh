#!/bin/bash

# Compile ld_preload exploit
cd ld_preload
gcc -fPIC -shared -nostartfiles -o ld_preload.so ld_preload.c
cd ..

# Set up LXC-privesc. 
read -p "Do you want to set up lxc privesc? It will update your packages [sudo apt update]. (y/n): " response1
if [[ "$response1" = "y" || "$response1" = "Y" ]]; then
    sudo apt update -y
    sudo apt install -y git golang-go debootstrap rsync gpg squashfs-tools
    cd lxc-priv
    git clone https://github.com/lxc/distrobuilder
    cd distrobuilder
    make
    cd ..
    wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml
    sudo $HOME/go/bin/distrobuilder build-incus alpine.yaml --type=split -o image.release=3.18
    cd ..
    # current directory malsploits/exploits/
else
    echo "No action taken. Exiting."
fi